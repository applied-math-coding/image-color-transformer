(function(e){function t(t){for(var a,n,c=t[0],l=t[1],i=t[2],u=0,h=[];u<c.length;u++)n=c[u],Object.prototype.hasOwnProperty.call(s,n)&&s[n]&&h.push(s[n][0]),s[n]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);d&&d(t);while(h.length)h.shift()();return o.push.apply(o,i||[]),r()}function r(){for(var e,t=0;t<o.length;t++){for(var r=o[t],a=!0,c=1;c<r.length;c++){var l=r[c];0!==s[l]&&(a=!1)}a&&(o.splice(t--,1),e=n(n.s=r[0]))}return e}var a={},s={app:0},o=[];function n(t){if(a[t])return a[t].exports;var r=a[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=a,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/image-color-transformer/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],l=c.push.bind(c);c.push=t,c=c.slice();for(var i=0;i<c.length;i++)t(c[i]);var d=l;o.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("cd49")},"01f2":function(e,t,r){"use strict";r("43af")},"2f40":function(e,t,r){},"43af":function(e,t,r){},"55ed":function(e,t,r){"use strict";r("2f40")},cd49:function(e,t,r){"use strict";r.r(t);var a=r("7a23");const s=Object(a["g"])("h1",{class:"text-center"},"Image Transformation",-1),o=Object(a["g"])("h3",{class:"text-center"}," Choose a color palette to get the selected image mapped. ",-1),n={class:"progress-positioner"},c={class:"color-palettes"},l={class:"images-container"},i=["src"],d={ref:"result",class:"result"},u={class:"settings-container mt-4"},h={class:"settings-positioner"},b=Object(a["g"])("h4",{class:"mb-1"},"Performance",-1),m={class:"text-xl"},g={class:"mt-5"},f=Object(a["g"])("h4",{class:"mt-0 mb-1"},"Number of workers",-1),p=Object(a["g"])("div",{class:"text-xs mt-1"}," For small images parallel computation tends to slow down processing. ",-1),j={key:0,class:"mt-5"},O=Object(a["g"])("h4",{class:"mt-0 mb-1"},"Use shared data",-1),w={class:"mt-5"},v=Object(a["g"])("h4",{class:"mt-0 mb-1"},"Replace image",-1),y={ref:"input",class:"input"};function k(e,t,r,k,P,I){const D=Object(a["s"])("ProgressBar"),S=Object(a["s"])("ColorPalette"),U=Object(a["s"])("InputNumber"),x=Object(a["s"])("Checkbox"),C=Object(a["s"])("FileUpload");return Object(a["o"])(),Object(a["f"])(a["a"],null,[s,o,Object(a["g"])("div",n,[e.processing?(Object(a["o"])(),Object(a["d"])(D,{key:0,mode:"indeterminate"})):Object(a["e"])("",!0)]),Object(a["g"])("div",c,[(Object(a["o"])(!0),Object(a["f"])(a["a"],null,Object(a["q"])(e.palettes,(r,s)=>(Object(a["o"])(),Object(a["d"])(S,{key:s,colors:r,selected:r===e.selectedPalette,onSelected:t[0]||(t[0]=t=>e.handlePaletteSelected(t))},null,8,["colors","selected"]))),128))]),Object(a["g"])("div",l,[Object(a["g"])("img",{ref:"selectedImage",class:"selected-image",src:e.selectedImageUrl},null,8,i),Object(a["g"])("canvas",d,null,512)]),Object(a["g"])("div",u,[Object(a["g"])("div",h,[Object(a["g"])("div",null,[b,Object(a["g"])("div",m,Object(a["u"])(e.formattedDuration),1)]),Object(a["g"])("div",g,[f,Object(a["i"])(U,{modelValue:e.numberWorkers,"onUpdate:modelValue":t[1]||(t[1]=t=>e.numberWorkers=t),step:1,min:1,showButtons:!0},null,8,["modelValue"]),p]),e.canUseSharedData?(Object(a["o"])(),Object(a["f"])("div",j,[O,Object(a["i"])(x,{modelValue:e.useSharedData,"onUpdate:modelValue":t[2]||(t[2]=t=>e.useSharedData=t),binary:!0},null,8,["modelValue"])])):Object(a["e"])("",!0),Object(a["g"])("div",w,[v,Object(a["i"])(C,{customUpload:!0,accept:"image/*",showUploadButton:!1,showCancelButton:!1,onSelect:t[3]||(t[3]=t=>e.handleFileSelected(t))})])])]),Object(a["g"])("canvas",y,null,512)],64)}var P=r("9ab4"),I=r("e8f7");function D(e,t,r,s,o,n){return Object(a["o"])(),Object(a["f"])("div",{class:Object(a["m"])(["color-container",{selected:e.selected}]),onClick:t[0]||(t[0]=t=>e.$emit("selected",e.colors))},[(Object(a["o"])(!0),Object(a["f"])(a["a"],null,Object(a["q"])(e.colors,e=>(Object(a["o"])(),Object(a["f"])("div",{key:e,class:"color",style:Object(a["n"])({"background-color":e})},null,4))),128))],2)}var S=Object(a["j"])({name:"ColorPalette",props:{colors:Object,selected:Boolean},emit:{selected(e){return e}},setup(){}}),U=(r("55ed"),r("d959")),x=r.n(U);const C=x()(S,[["render",D]]);var W=C,B=r("c045"),M=r("3822"),V=r("2052");const _=[["#91665e","#19141c","#5f4549","#331a13","#b4b1cb"],["#3e1a33","#f04e9e","#0f0b16","#0b0c0b","#140b0b"],["#dc443c","#dfbd80","#374f6d","#23233b","#a4a484"],["#e6d4c3","#8d7968","#c1ad9b","#fbecda","#cab7a6"]];var A=Object(a["j"])({name:"App",components:{FileUpload:I["a"],ColorPalette:W,ProgressBar:B["a"],InputNumber:M["a"],Checkbox:V["a"]},data(){return{palettes:_,selectedPalette:_[0],processing:!1,duration:0,publicPath:"/image-color-transformer/",selectedImageUrl:"",workers:[],numberWorkers:window.navigator.hardwareConcurrency,useSharedData:window.crossOriginIsolated,canUseSharedData:window.crossOriginIsolated}},computed:{formattedDuration(){return Math.round(this.duration)+" ms"}},mounted(){this.selectedImageUrl=this.publicPath+"example.jpg",this.process(this.selectedImageUrl,Object(a["w"])(this.selectedPalette),this.useSharedData)},methods:{handleFileSelected({files:e}){const t=e[0];this.selectedImageUrl=URL.createObjectURL(t),this.process(this.selectedImageUrl,Object(a["w"])(this.selectedPalette),this.useSharedData)},handlePaletteSelected(e){this.selectedPalette=e,this.process(this.selectedImageUrl,Object(a["w"])(this.selectedPalette),this.useSharedData)},terminateWorkers(){(this.workers||[]).forEach(e=>e.terminate())},createWorkers(e){const t=e?"shared-color-transformer.js":"color-transformer.js";return Array(this.numberWorkers).fill(null).map(()=>new Worker(this.publicPath+t))},process(e,t,r){return Object(P["a"])(this,void 0,void 0,(function*(){this.processing=!0;const a=performance.now();this.terminateWorkers();const s=yield this.extractImageData(e);this.workers=this.createWorkers(r);const o=yield r?this.sharedTransformImageData(s,this.workers,t):this.transformImageData(s,this.workers,t),n=this.$refs.result;n.width=s.width,n.height=s.height;const c=n.getContext("2d");null===c||void 0===c||c.putImageData(o,0,0),this.processing=!1,this.duration=performance.now()-a}))},sharedTransformImageData(e,t,r){return Object(P["a"])(this,void 0,void 0,(function*(){const a=Math.floor(e.width/t.length),s=new SharedArrayBuffer(e.data.buffer.byteLength),o=new Uint8ClampedArray(s);o.set(e.data);const n=t.map((e,s)=>this.sharedRunWorker(e,o,4*s*a,s===t.length-1?void 0:4*(s+1)*a,r));return yield Promise.all(n),new ImageData(o.slice(),e.width,e.height)}))},transformImageData(e,t,r){return Object(P["a"])(this,void 0,void 0,(function*(){const a=Math.floor(e.width/t.length),s=t.map((s,o)=>this.runWorker(s,e.data.slice(4*o*a,o===t.length-1?void 0:4*(o+1)*a).buffer,r)),o=yield Promise.all(s),n=new Blob(o),c=new Uint8ClampedArray(yield n.arrayBuffer());return new ImageData(c,e.width,e.height)}))},runWorker(e,t,r){return new Promise(a=>{e.onmessage=({data:e})=>a(e),e.postMessage({imageData:t,palette:r},[t])})},sharedRunWorker(e,t,r,a,s){return new Promise(o=>{e.onmessage=()=>o(),e.postMessage({imageData:t,palette:s,start:r,end:a})})},extractImageData(e){const t=new Image;return t.src=e,new Promise(e=>{t.addEventListener("load",()=>{const r=this.$refs.selectedImage.width,a=r/t.width;t.width=r,t.height=a*t.height;const s=this.$refs.input;s.width=t.width,s.height=t.height;const o=s.getContext("2d");null===o||void 0===o||o.drawImage(t,0,0,t.width,t.height),e(null===o||void 0===o?void 0:o.getImageData(0,0,t.width,t.height))})})}}});r("01f2");const F=x()(A,[["render",k]]);var R=F,T=r("9319");r("098b"),r("e1ae"),r("4121"),r("bddf");const L=Object(a["c"])(R);L.use(T["a"]).mount("#app")}});
//# sourceMappingURL=app.8430d0b8.js.map