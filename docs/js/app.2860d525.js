(function(e){function t(t){for(var s,a,n=t[0],l=t[1],i=t[2],u=0,b=[];u<n.length;u++)a=n[u],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&b.push(o[a][0]),o[a]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(e[s]=l[s]);d&&d(t);while(b.length)b.shift()();return c.push.apply(c,i||[]),r()}function r(){for(var e,t=0;t<c.length;t++){for(var r=c[t],s=!0,n=1;n<r.length;n++){var l=r[n];0!==o[l]&&(s=!1)}s&&(c.splice(t--,1),e=a(a.s=r[0]))}return e}var s={},o={app:0},c=[];function a(t){if(s[t])return s[t].exports;var r=s[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=s,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)a.d(r,s,function(t){return e[t]}.bind(null,s));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],l=n.push.bind(n);n.push=t,n=n.slice();for(var i=0;i<n.length;i++)t(n[i]);var d=l;c.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("cd49")},"01f2":function(e,t,r){"use strict";r("43af")},"2f40":function(e,t,r){},"43af":function(e,t,r){},"55ed":function(e,t,r){"use strict";r("2f40")},cd49:function(e,t,r){"use strict";r.r(t);var s=r("7a23");const o=Object(s["g"])("h1",{class:"text-center"},"Image Transformation",-1),c=Object(s["g"])("h3",{class:"text-center"}," Choose a color palette to get the selected image mapped. ",-1),a={class:"progress-positioner"},n={class:"color-palettes"},l={class:"images-container"},i=["src"],d={ref:"result",class:"result"},u={class:"settings-container mt-4"},b={class:"settings-positioner"},h=Object(s["g"])("h4",{class:"mb-1"},"Performance",-1),p={class:"text-xl"},m={class:"mt-5"},f=Object(s["g"])("h4",{class:"mt-0 mb-1"},"Number of workers",-1),g=Object(s["g"])("div",{class:"text-xs mt-1"},"For small images parallel computation tends to slow down processing.",-1),j={class:"mt-5"},O=Object(s["g"])("h4",{class:"mt-0 mb-1"},"Replace image",-1),v={ref:"input",class:"input"};function w(e,t,r,w,y,P){const k=Object(s["s"])("ProgressBar"),I=Object(s["s"])("ColorPalette"),x=Object(s["s"])("InputNumber"),U=Object(s["s"])("FileUpload");return Object(s["o"])(),Object(s["f"])(s["a"],null,[o,c,Object(s["g"])("div",a,[e.processing?(Object(s["o"])(),Object(s["d"])(k,{key:0,mode:"indeterminate"})):Object(s["e"])("",!0)]),Object(s["g"])("div",n,[(Object(s["o"])(!0),Object(s["f"])(s["a"],null,Object(s["q"])(e.palettes,(r,o)=>(Object(s["o"])(),Object(s["d"])(I,{key:o,colors:r,selected:r===e.selectedPalette,onSelected:t[0]||(t[0]=t=>e.handlePaletteSelected(t))},null,8,["colors","selected"]))),128))]),Object(s["g"])("div",l,[Object(s["g"])("img",{ref:"selectedImage",class:"selected-image",src:e.selectedImageUrl},null,8,i),Object(s["g"])("canvas",d,null,512)]),Object(s["g"])("div",u,[Object(s["g"])("div",b,[Object(s["g"])("div",null,[h,Object(s["g"])("div",p,Object(s["u"])(e.formattedDuration),1)]),Object(s["g"])("div",m,[f,Object(s["i"])(x,{modelValue:e.numberWorkers,"onUpdate:modelValue":t[1]||(t[1]=t=>e.numberWorkers=t),step:1,min:1,showButtons:!0},null,8,["modelValue"]),g]),Object(s["g"])("div",j,[O,Object(s["i"])(U,{customUpload:!0,accept:"image/*",showUploadButton:!1,showCancelButton:!1,onSelect:t[2]||(t[2]=t=>e.handleFileSelected(t))})])])]),Object(s["g"])("canvas",v,null,512)],64)}var y=r("9ab4"),P=r("e8f7");function k(e,t,r,o,c,a){return Object(s["o"])(),Object(s["f"])("div",{class:Object(s["m"])(["color-container",{selected:e.selected}]),onClick:t[0]||(t[0]=t=>e.$emit("selected",e.colors))},[(Object(s["o"])(!0),Object(s["f"])(s["a"],null,Object(s["q"])(e.colors,e=>(Object(s["o"])(),Object(s["f"])("div",{key:e,class:"color",style:Object(s["n"])({"background-color":e})},null,4))),128))],2)}var I=Object(s["j"])({name:"ColorPalette",props:{colors:Object,selected:Boolean},emit:{selected(e){return e}},setup(){}}),x=(r("55ed"),r("d959")),U=r.n(x);const S=U()(I,[["render",k]]);var W=S,C=r("c045"),D=r("3822");const B=[["#91665e","#19141c","#5f4549","#331a13","#b4b1cb"],["#3e1a33","#f04e9e","#0f0b16","#0b0c0b","#140b0b"],["#dc443c","#dfbd80","#374f6d","#23233b","#a4a484"],["#e6d4c3","#8d7968","#c1ad9b","#fbecda","#cab7a6"]];var M=Object(s["j"])({name:"App",components:{FileUpload:P["a"],ColorPalette:W,ProgressBar:C["a"],InputNumber:D["a"]},data(){return{palettes:B,selectedPalette:B[0],processing:!1,duration:0,publicPath:"/",selectedImageUrl:"",workers:[],numberWorkers:window.navigator.hardwareConcurrency}},computed:{formattedDuration(){return Math.round(this.duration)+" ms"}},mounted(){this.selectedImageUrl=this.publicPath+"example.jpg",this.process(this.selectedImageUrl,Object(s["w"])(this.selectedPalette))},methods:{handleFileSelected({files:e}){const t=e[0];this.selectedImageUrl=URL.createObjectURL(t),this.process(this.selectedImageUrl,Object(s["w"])(this.selectedPalette))},handlePaletteSelected(e){this.selectedPalette=e,this.process(this.selectedImageUrl,Object(s["w"])(this.selectedPalette))},terminateWorkers(){(this.workers||[]).forEach(e=>e.terminate())},createWorkers(){return Array(this.numberWorkers).fill(null).map(()=>new Worker(this.publicPath+"color-transformer.js"))},process(e,t){return Object(y["a"])(this,void 0,void 0,(function*(){this.processing=!0;const r=performance.now();this.terminateWorkers();const s=yield this.extractImageData(e);this.workers=this.createWorkers();const o=yield this.transformImageData(s,this.workers,t),c=this.$refs.result;c.width=s.width,c.height=s.height;const a=c.getContext("2d");null===a||void 0===a||a.putImageData(o,0,0),this.processing=!1,this.duration=performance.now()-r}))},transformImageData(e,t,r){return Object(y["a"])(this,void 0,void 0,(function*(){const s=Math.floor(e.width/t.length),o=t.map((o,c)=>this.runWorker(o,e.data.slice(4*c*s,c===t.length-1?void 0:4*(c+1)*s).buffer,r)),c=yield Promise.all(o),a=new Blob(c),n=new Uint8ClampedArray(yield a.arrayBuffer());return new ImageData(n,e.width,e.height)}))},runWorker(e,t,r){return new Promise(s=>{e.onmessage=({data:e})=>s(e),e.postMessage({imageData:t,palette:r},[t])})},extractImageData(e){const t=new Image;return t.src=e,new Promise(e=>{t.addEventListener("load",()=>{const r=this.$refs.selectedImage.width,s=r/t.width;t.width=r,t.height=s*t.height;const o=this.$refs.input;o.width=t.width,o.height=t.height;const c=o.getContext("2d");null===c||void 0===c||c.drawImage(t,0,0,t.width,t.height),e(null===c||void 0===c?void 0:c.getImageData(0,0,t.width,t.height))})})}}});r("01f2");const _=U()(M,[["render",w]]);var F=_,$=r("9319");r("098b"),r("e1ae"),r("4121"),r("bddf");const A=Object(s["c"])(F);A.use($["a"]).mount("#app")}});
//# sourceMappingURL=app.2860d525.js.map